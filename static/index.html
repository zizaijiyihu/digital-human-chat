<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数字人对话</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <h1>🤖 数字人对话系统</h1>

        <div class="main-content">
            <!-- 左侧：摄像头区域 -->
            <div class="video-section">
                <h2>📹 您的视频</h2>
                <div class="video-container">
                    <video id="videoPreview" autoplay muted playsinline></video>
                    <div id="cameraPlaceholder" class="camera-placeholder">
                        <p>请点击下方按钮开启摄像头</p>
                    </div>
                </div>
                <div class="controls">
                    <button id="requestCamera" class="btn btn-primary">📷 开启摄像头</button>
                    <button id="videoCallBtn" class="btn btn-video-call">
                        📹 进入视频通话
                    </button>
                    <button id="recordBtn" class="btn btn-record" style="display:none;" disabled>
                        🎙️ 按住说话（视频）
                    </button>
                    <button id="audioRecordBtn" class="btn btn-audio-record">
                        🎤 按住说话（音频）
                    </button>
                    <label for="imageUpload" class="btn btn-image-upload">
                        🖼️ 上传图片点评
                        <input type="file" id="imageUpload" accept="image/*" style="display:none;">
                    </label>
                    <button id="settingsBtn" class="btn btn-settings">
                        ⚙️ 系统设置
                    </button>
                </div>
                <div id="imagePreview" class="image-preview" style="display:none;">
                    <img id="previewImg" src="" alt="预览图片">
                    <button id="clearImage" class="btn-clear">✕</button>
                </div>
                <div id="recordingIndicator" class="recording-indicator" style="display:none;">
                    🔴 录制中...
                </div>
                <div id="status" class="status"></div>
            </div>

            <!-- 右侧：数字人区域 -->
            <div class="avatar-section">
                <h2>👤 数字人</h2>
                <div id="avatar" class="avatar-container"></div>
            </div>
        </div>

        <!-- 对话历史 -->
        <div class="chat-history">
            <h2>💬 对话记录</h2>
            <div id="chatLog" class="chat-log">
                <p class="empty-hint">开始对话后，对话记录将显示在这里</p>
            </div>
        </div>

        <!-- 视频预览区域 -->
        <div class="video-preview-section">
            <h2>🎬 视频预览（调试用）</h2>
            <div class="video-preview-container">
                <div class="video-group">
                    <h3>原始视频片段</h3>
                    <div id="segmentVideos" class="segment-videos">
                        <p class="empty-hint">使用视频通话模式后，这里会显示原始视频片段</p>
                    </div>
                </div>
                <div class="video-group">
                    <h3>拼接后的视频</h3>
                    <div id="mergedVideo" class="merged-video">
                        <p class="empty-hint">使用视频通话模式后，这里会显示合并后的视频</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 系统设置弹窗 -->
    <div id="settingsModal" class="modal" style="display:none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>⚙️ 系统设置</h2>
                <button class="modal-close" id="closeSettings">✕</button>
            </div>
            <div class="modal-body">
                <div class="setting-item">
                    <label for="systemPrompt">系统提示词：</label>
                    <textarea
                        id="systemPrompt"
                        class="prompt-textarea"
                        rows="5"
                        placeholder="请输入系统提示词..."></textarea>
                    <div class="setting-hint">
                        💡 提示：系统提示词会在每次视频通话时发送给 AI，用于指导 AI 的回复风格和内容。
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="saveSettings" class="btn btn-primary">💾 保存设置</button>
                <button id="cancelSettings" class="btn btn-secondary">取消</button>
            </div>
        </div>
    </div>

    <!-- Import Map for Three.js -->
    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
        }
    }
    </script>

    <script type="module" src="/static/app.js"></script>
</body>
</html>
